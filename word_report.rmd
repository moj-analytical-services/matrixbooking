---
date:  "`r format(Sys.time(), '%d %B, %Y')`"
always_allow_html: yes
output: 
  word_document:
    toc: true
    reference_docx: matrixbooking-report-reference.dotx

params:
  start_date: NULL
  end_date: NULL
  joined_observations: NULL
  bookings: NULL
  survey_name: NULL
  
title: "`r paste0('Meeting room usage report, ', params$survey_name)`"
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)

```

#####

# Room bookings report for `r params$start_date` to `r params$end_date`

This report shows utilisation of meeting rooms in the working week, 9am-5pm Monday to Friday.


```{r summary, echo=FALSE, results='asis', dpi = 150, fig.width=8.9, fig.height=5}
joined_observations <- params$joined_observations

cat("## Summary table")

knitr::kable(permutation_summary(joined_observations), col.names = c("", "Working Hours", "proportions"))

cat("## Summary pie chart \n")

pie <- permutation_summary_pie(joined_observations)

pie
```

## Overall utilisation

The following charts show the rates of occupancy, by room type and by weekday.
- Unused room: An unused room is a room which is not occupied for an entire day. To account for potential errors desks have been classified as unused where desk utilisation in the sample period is less than 15%.
- Under Utilised rooms: For the purposes of this report an under utilised room is a used room which is used for less than 50% of the time during the day.
In use: a room is used for more than 50% of the day.

```{r utilisation, echo=FALSE, results='asis', dpi = 150, fig.width=8.9, fig.height=5}
cat("\n\n## Occupancy by room type \n\n")
print(room_utilisation_by_type(joined_observations))

cat("\n\n## Occupancy by weekday")

```

## Charts by room

```{r charts_by_room, echo=FALSE, results='asis', dpi = 150, fig.width=8.9, fig.height=5}

room_list <- unique(params$joined_observations$roomname)
for(room in room_list) {
  cat("\n\n## ", room, "\n\n", sep = "")
  filtered_observations <- joined_observations %>%
    dplyr::filter(roomname == room)
  
  print(occupancy_through_day(filtered_observations))
  
}
```